<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Index</title>
</head>
<body>
  
</body>
<script type="module">
  import { useDataSynchronizer, DataSynchronizer } from './index.esm.js';

  // formatMap['promise'] = {
  //   from(p) {
  //     return {
  //       $type: 'promise',
  //       $value: p.toString(),
  //     }
  //   },
  //   to(value) {
  //     console.log(value);
  //     return value;
  //   }
  // }

  // const { onMessage } = useDataSynchronizer({
  //   chan: 'chan_1',
  //   engine: 'LocalStorage'
  // });

  // onMessage((o) => {
  //   console.log('useDataSynchronizer:onMessage', o);
  // })

  // const { onMessage: onMessage2 } = useDataSynchronizer({});
  // onMessage2((o) => {
  //   console.log('useDataSynchronizer:onMessage2', o);
  // })

  const chan1 = 'chan_1';

  const chan2 = 'chan_2';

  const chan3 = 'chan_3';

  const instance = new DataSynchronizer({
    // engine: 'BroadcastChannel'
    engine: 'LocalStorage'
  });

  instance.onMessage([chan1, chan2], (o) => {
    console.log('DataSynchronizer:instance.onMessage1', o);
    // const map = o.$payload.map;
    // const { handle } = map.get("function");
    // handle('hello ', 'I am ', 'xiongyechang');
    // o.$payload.printData('hello everyone', 'today is', 'wonsday');
  })

  instance.onMessage([chan1, chan3], (o) => {
    console.log('DataSynchronizer:instance.onMessage2', o);
  })

  // instance.close();

  // const instance2 = new DataSynchronizer({
  //   chan: 'chan_1',
  //   engine: 'LocalStorage'
  // });

  // instance2.onMessage((o) => {
  //   console.log('DataSynchronizer:instance2.onMessage', o);
  // })

</script>
</html>