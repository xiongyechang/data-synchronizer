<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Details</title>
</head>
<body>
  
</body>
<script type="module">
  import { useDataSynchronizer, DataSynchronizer } from './index.esm.min.js'
  // const { sendMessage } = useDataSynchronizer({
  //   chan: 'chan_1',
  //   engine: "LocalStorage"
  // });
  
  // sendMessage({
  //   data: 'hello world'
  // }, 
    // /http:\/\/10.241.39.224:3000/
    // "http://10.241.39.224:3000"
  // });

  const instance = new DataSynchronizer({
    chan: 'chan_1',
    engine: 'LocalStorage',
    // engine: 'BroadcastChannel'
  });

  instance.onMessageError((event) => {
    console.log(event);
  })

  const set = new Set();

  set.add(1).add('2').add(true).add([1, '2', false]).add({
    key: 'log',
    value: function (msg) { console.log(msg) }
  })

  const map = new Map();

  map.set('name', 'xiongyechang').set(1, 1).set({
    lastname: 'xiong'
  }, {
    firstname: 'yechang'
  }).set([1,1,0], {
    a: 'a',
    b: 'b'
  }).set('function', {
    handle(a, b, c) {
      console.log('handle:', a, b, c);
    }
  })

  const d = {
    data: 110,
    name: 'huka',
    finished: true,
    store: {
      a: {
        b: 'data.a.b'
      }
    },
    biging: BigInt(111),
    sy: Symbol('he'),
    reg: /hello world/,
    date: new Date(),
    set,
    map,
    array: [11, '22', set, true, false, {
      name: 'xiongyechang',
      getName() {
        return this.name;
      }
    }],
    printData: function(a, b, c) {
      console.log(a, b, c);
    },
    value: null,
    // promise: new Promise((resolve) => {
    //   resolve(1);
    // })
    // 不支持
    // sayHello: () => {
    //   console.log('hello');
    // }
  }

  console.log(d);

  instance.sendMessage(d,
    /http:\/\/localhost:3000\/$/
  );

  // const instance2 = new DataSynchronizer({
  //   chan: 'chan_1',
  //   engine: 'LocalStorage'
  // });
  // console.log(instance2);
  // instance2.sendMessage({
  //   data: false
  // }, 
  //   /http:\/\/10.241.39.224:3000/
  // );
</script>
</html>